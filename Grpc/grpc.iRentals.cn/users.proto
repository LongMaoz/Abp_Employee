syntax = "proto3";

package users;

import "google/protobuf/any.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/wrappers.proto";

message ByIdsRequest {
    repeated int32 ids = 1;
}

// --- 用户接口 START ---
message User {
    string id = 1;
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    bool isRobot = 5;
    string realm = 6;
    string username = 7;
    string password = 8;
    string email = 9;
    bool emailVerified = 10;
    string phoneNumber = 11;
    bool phoneNumberVerified = 12;
    string name = 13;
    string displayName = 14;
    string gender = 15;
    string birthdate = 16;
    string bio = 17;
    string avatar = 18;
    Membership memberShip = 19;
    map<string, string> claims = 20;
}

message UserBlacklist {
    int32 id = 1;
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    int64 userId = 5;
    string type = 6;// RENTING：租赁 HOSTING：托管 BOTH: 租赁和托管
    int32 operatorId = 7;
    string operatorName = 8;
    string reason = 9;
}

message UserMembership {
    int32 id = 1;
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    string userId = 5;
    int32 membershipId = 6;
    int32 growth = 7;
    int32 coin = 8;
    Membership membership = 9;
    repeated DiscountRate discountRates = 10;
}

message DiscountRate {
    int32 id = 1;
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    double discount = 5;
    int32 membershipId = 6;
    int32 days = 7;
}

message UserCredit {
    int32 id = 1;
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    string userId = 5;
    double subtotal = 6;
    double used = 7;
}

message UserWallet {
    int32 id = 1;
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    string userId = 5;
    double balance = 6;
}

message Membership {
    int32 id = 1;
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    string name = 5;
    string abbr = 6;
    int32 threshold = 7;
    double creditPercentage = 8;
    double creditCeiling = 9;
    int32 creditCount = 10;
    repeated DiscountRate discountRates = 11;
}

message UserProfile {
    string id = 1;
    string name = 2;
    string displayName = 3;
    string gender = 4;
    string birthdate = 5;
    string bio = 6;
    string avatar = 7;
}

message UserCert {
    int64 id = 1;
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    int64 userId = 5;
    map<string,string> images = 6;
    repeated string urls = 7;
    string name = 8;
    string idCard = 9;
    string issuingAuthority = 10;
    string validFrom = 11;
    string validTo = 12;
    string address = 13;
    string status = 14;
}

// 客户标签详情
message UserTag {
    int32 id = 1;
    string addTime = 2; // 标签添加时间
    int32 tagId = 3;
    string tagName = 4;
    google.protobuf.DoubleValue creditPercentage = 5;
    google.protobuf.DoubleValue creditCeiling = 6;
    google.protobuf.Int32Value creditCount = 7;
}

message GenerateTokenRequest {
    string secret = 1;
}

message VerifyTokenRequest {
    string secret = 1;
    string token = 2;
    int32 window = 3;
}

message ChangeEmailRequest {
    string id = 1;
    string email = 2;
    string verificationCode = 3;
}

message ChangePhoneNumberRequest {
    string id = 1;
    string phoneNumber = 2;
    string verificationCode = 3;
}

message ChangePhoneNumberOrMergeUserRequest {
    string id = 1;
    string phoneNumber = 2;
}

message HasPasswordRequest {
    string id = 1;
    string password = 2;
}

message ChangePasswordRequest {
    string id = 1;
    string oldPassword = 2;
    string newPassword = 3;
}

message ResetPasswordByEmailRequest {
    string email = 1;
    string verificationCode = 2;
    string password = 3;
}

message ResetPasswordByPhoneNumberRequest {
    string phoneNumber = 1;
    string verificationCode = 2;
    string password = 3;
}

message UserInfoAllRequest {
    int64 id = 1;
    string provider = 2; // 获取客户第三方账号需传
    repeated string scope = 3; // ScopeEnum  USER:客户基本信息,  ACCOUNT:客户第三方账号,  BLACKLIST:客户黑名单信息,  IDENTITY:客户实名信息,  MEMBERSHIP:客户会员等级,  CREDIT:客户免押额度
}

message UserInfoRequestByIds {
    int64 id = 1; // 客户ID
    string provider = 2; // 获取客户第三方账号需传
}

message UserInfoAllRequestByIds {
    repeated UserInfoRequestByIds datas = 1;
    repeated string scope = 2; // ScopeEnum  USER:客户基本信息,  ACCOUNT:客户第三方账号,  BLACKLIST:客户黑名单信息,  IDENTITY:客户实名信息,  MEMBERSHIP:客户会员等级,  CREDIT:客户免押额度,  TAG:客户标签
    repeated int32 tagIds = 3;// scope=TAG时，可获取指定客户标签。不传或者为空，则返回全部客户标签
}

message UserById {
    string id = 1;
}

message UserByUsername {
    string username = 1;
}

message UserByEmail {
    string email = 1;
}

message UserByPhoneNumber {
    string phoneNumber = 1;
}

message UserByExternalId {
    string provider = 1;
    string externalId = 2;
}

message UsersById {
    repeated string ids = 1;
}

message ListUsersRequest {
    int32 offset = 1;
    int32 limit = 2;
}

message SearchUsersRequest {
    string keyword = 1;
    int32 offset = 2;
    int32 limit = 3;
}

message UserResult {
    User data = 1;
}

message UsersResult {
    int32 total = 1;
    repeated User data = 2;
}

message UserBlacklistsResult {
    int32 total = 1;
    repeated UserBlacklist data = 2;
}

message UserMembershipsResult {
    int32 total = 1;
    repeated UserMembership data = 2;
}

message UserInfoAllResult {
    UserMembership userMembership = 1;
    UserBlacklist userBlacklist = 2;
    UserAccount userAccount = 3;
    UserCert userCert = 4;
    User user = 5;
    UserCredit userCredit = 6;
    repeated UserTag userTags = 7;
}

message UserInfoAllResultByIds {
    int32 total = 1;
    repeated UserInfoAllResult data = 2;    
}

message EvaluateUserCreditRequest {
    int64 userId = 1;
    double deposit = 2;
    int64 orderId = 3;
}

message EvaluateUserCreditResult {
    double credit = 1;
    string reason = 2;
}

service UsersService {
    rpc GenerateToken (GenerateTokenRequest) returns (google.protobuf.StringValue) {}
    rpc VerifyToken (VerifyTokenRequest) returns (google.protobuf.BoolValue) {}
    rpc RegisterUser (User) returns (User) {}
    rpc UpdateProfile (UserProfile) returns (User) {}
    rpc ChangeEmail (ChangeEmailRequest) returns (google.protobuf.Empty) {}
    rpc ChangePhoneNumber (ChangePhoneNumberRequest) returns (google.protobuf.Empty) {}
    rpc ChangePhoneNumberOrMergeUser (ChangePhoneNumberOrMergeUserRequest) returns (User) {}
    rpc HasPassword (HasPasswordRequest) returns (google.protobuf.BoolValue) {}
    rpc ChangePassword (ChangePasswordRequest) returns (google.protobuf.Empty) {}
    rpc ResetPasswordByEmail (ResetPasswordByEmailRequest) returns (google.protobuf.Empty) {}
    rpc ResetPasswordByPhoneNumber (ResetPasswordByPhoneNumberRequest) returns (google.protobuf.Empty) {}
    rpc DestroyUser (UserById) returns (google.protobuf.Empty) {}
    rpc GetUserById (UserById) returns (User) {}
    rpc GetUserInfoById (UserById) returns (User) {}
    rpc GetUserByUsername (UserByUsername) returns (UserResult) {}
    rpc GetUserByEmail (UserByEmail) returns (UserResult) {}
    rpc GetUserByPhoneNumber (UserByPhoneNumber) returns (UserResult) {}
    rpc GetUserByExternalId (UserByExternalId) returns (UserResult) {}
    rpc GetUsersByIds (UsersById) returns (UsersResult) {}
    rpc ListUsers (ListUsersRequest) returns (UsersResult) {}
    rpc SearchUsers (SearchUsersRequest) returns (UsersResult) {}
    rpc GetMembershipById (UserById) returns (UserMembership) {}
    rpc GetCreditById (UserById) returns (UserCredit) {}
    rpc GetBalanceById (UserById) returns (UserWallet) {}
    rpc GetMembershipAndDiscountRateById (UserById) returns (UserMembershipsResult) {}
    rpc GetUserBlacklistById (UserById) returns (UserBlacklistsResult) {}
    rpc GetUserBlacklistByIds (UsersById) returns (UserBlacklistsResult) {}
    rpc GetUserInfoAllById (UserInfoAllRequest) returns (UserInfoAllResult) {}
    rpc GetUserInfoAllByIds (UserInfoAllRequestByIds) returns (UserInfoAllResultByIds) {}
    rpc EvaluateUserCredit(EvaluateUserCreditRequest) returns (EvaluateUserCreditResult) {}
}

// --- 用户接口 END ---
// --- 会员等级接口 START ---

message ListRequest {}

message MembershipsResult {
    int32 total = 1;
    repeated Membership data = 2;
}

service MembershipService {
    rpc GetMemberships (ListRequest) returns (MembershipsResult) {}
}

// --- 会员等级接口 END ---
// --- 用户积分接口 START ---

message UserCoin {
    string id = 1;
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    string userId = 5;
    string type = 6;
    int32 value = 7;
    string evidence = 8;
    Others others = 9;  
    string remark = 10;   
}

message Others {}

message CreateCoin {
    string userId = 1;
    string type = 2;
    int32 value = 3;
    string evidence = 4;  
    string remark = 5;     
}

message CreateCoinMultipleRequest {
    repeated CreateCoin data = 1;
}

message CreateCoinMultipleResult {
    repeated UserCoin data = 1;
}

message CoinById {
    string id = 1;
}

service UserCoinService {
    rpc CreateUserCoin (CreateCoin) returns (UserCoin) {}
    rpc CreateUserCoinMultiple (CreateCoinMultipleRequest) returns (CreateCoinMultipleResult);
    rpc DeleteUserCoinById (CoinById) returns (google.protobuf.BoolValue) {}
}

// --- 用户积分接口 END ---

// --- 用户成长值接口 START ---

message UserGrowth {
    string id = 1;
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    string userId = 5;
    string type = 6;
    int32 value = 7;
    string evidence = 8;
    string remark = 9; 
}

message CreateGrowth {
    string userId = 1;
    string type = 2;
    int32 value = 3;
    string evidence = 4;    
    string remark = 5;    
}

message GrowthById {
    string id = 1;
}

service UserGrowthService {
    rpc CreateUserGrowth (CreateGrowth) returns (UserGrowth) {}
    rpc DeleteUserGrowthById (GrowthById) returns (google.protobuf.BoolValue) {}
}

// --- 用户成长值接口 END ---

// --- 用户第三方账号接口 START ---

message UserAccount {
    int64 id = 1;
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    int64 userId = 5;
    string provider = 6;
    string externalId = 7;
    string profile = 8;
    string credentials = 9; 
}
message UserAccountResult {
    int32 total = 1;
    repeated UserAccount data = 2;
}
message CreateAccount {
    int64 userId = 1;
    string provider = 2;
    string externalId = 3;
    string profile = 4;
    string credentials = 5; 
}
message UpdateAccount {
    int64 id = 1;
    int64 userId = 2;
    string provider = 3;
    string externalId = 4;
    string profile = 5;
    string credentials = 6; 
}
message AccountById {
    int64 id = 1;
}
message AccountByIds {
    repeated int64 ids = 1;
}
message AccountParams {
    string provider = 1;
    string externalId = 2;
}
message AccountByUserId {
    int64 userId = 1;
    string provider = 2;
}
service UserAccountService {
    rpc CreateUserAccount (CreateAccount) returns (UserAccount) {}
    rpc UpdateUserAccount (UpdateAccount) returns (UserAccount) {}
    rpc DeleteUserAccountById (AccountById) returns (google.protobuf.Empty) {}
    rpc GetUserAccountByUserId (AccountByUserId) returns (UserAccountResult) {}
    rpc GetUserAccountById (AccountById) returns (UserAccountResult) {}
    rpc GetUserAccountByIds (AccountByIds) returns (UserAccountResult) {}
    rpc GetUserAccountByParams (AccountParams) returns (UserAccountResult) {}
}

// --- 用户第三方账号接口 END ---

message ByUserId {
    int64 userId = 1;
    google.protobuf.BoolValue getUrl = 2; // 是否获取七牛云照片可访问地址
}

// --- 用户实名认证接口 START ---

message UserCertResult {
    UserCert data = 1;
}

service UserCertService {
    rpc GetUserCertByUserId (ByUserId) returns (UserCertResult) {}
}

// --- 用户实名认证接口 END ---
// --- 用户地址接口 START ---

message ByUserIdRequest {
    int64 userId = 1;
}

message UserAddress {
    int64 id = 1;
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    int64 userId = 5;
    string name = 6;
    string gender = 7;
    string phoneNumber = 8;
    string province = 9;
    string city = 10;
    string district = 11;
    string street = 12;
    string label = 13;
    bool isPreferred = 14;
    string creatorId = 15;
    string deleterId = 16;
    string operatorId = 17;
    string operatorName = 18;
}

message UserAddressesResult {
    int32 total = 1;
    repeated UserAddress data = 2;
}

service UserAddressService {
    rpc GetUserAddressesAllByUserId (ByUserIdRequest) returns (UserAddressesResult) {}
}

// --- 用户地址接口 END ---
// --- 用户标签接口 START ---

message UserByTagIdRequest {
    int32 tagId = 1;// 标签ID
    int32 offset = 2;
    int32 limit = 3;
    bool isRandom = 4;// 是否随机
}

message UserTagResult {
    int32 total = 1;
    repeated User data = 2;
    int32 tagId = 3;// 标签ID
}

service UserTagService {
    rpc GetUserPageByTagId(UserByTagIdRequest) returns (UserTagResult) {}// 根据客户标签ID，获取客户列表
}
// --- 用户标签接口 END ---
// --- 用户额外接口 START ---

message UserByOrder {
    string phoneNumber = 1;
    string displayName = 2;
    string wangWang = 3;
}

message UserAddressByOrder {
    string phoneNumber = 1;
    string name = 2;
    string province = 3;
    string city = 4;
    string district = 5;
    string street = 6;
}

message OrderUserAndAddressRequest {
    UserByOrder user = 1;
    UserAddressByOrder address = 2;
}

message OrderUserAndAddressResult {
    User user = 1;
    UserAddress address = 2;
}

service UsersExtraService {
    rpc CheckUserAndAddressByOrder (OrderUserAndAddressRequest) returns (OrderUserAndAddressResult) {}
}

// --- 用户额外接口 END ---
// --- 标签接口 START ---
message Tag {
    int32 id = 1;    
    string createTime = 2;
    string updateTime = 3;
    string deleteTime = 4;
    int32 operatorId = 5;
    string operatorName = 6;
    string name = 7;
    google.protobuf.StringValue remark = 8;
    google.protobuf.DoubleValue creditPercentage = 9;
    google.protobuf.DoubleValue creditCeiling = 10;
    google.protobuf.Int32Value creditCount = 11;
}

message ListTagResult {
    int32 total = 1;
    repeated Tag data = 2;
}

service TagService {
    rpc ListTagByIds(ByIdsRequest) returns (ListTagResult) {} // 根据标签ID数组，获取标签列表
}
// --- 标签接口 END ---